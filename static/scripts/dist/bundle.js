!function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var a={size:{x:150,y:200},position:{x:30,y:190},color:"#fff",health:{color:"green",max:100,size:23},magic:{color:"blue",max:100,size:23}},i={1:function(e){return{x:e.x+(e.attackStartTime-e.currentAttackTime),y:e.y+50}},2:function(e){return{x:e.x-50-(e.attackStartTime-e.currentAttackTime),y:e.y+120}}};function r(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t}var t,n,o;return t=e,(n=[{key:"render",value:function(){var e=this.game.ctx;e.clearRect(0,0,this.game.gameWidth,this.game.gameHeight),this.drawBackground(e),this.drawText(e),this.drawPlayers(e)}},{key:"drawBackground",value:function(e){e.globalAlpha=.6,e.drawImage(this.game.background,0,0),e.globalAlpha=1}},{key:"drawText",value:function(e){e.font="16px Arial",e.fillStyle="#fff",e.textAlign="center",e.fillText(this.game.player1.getName()+" против "+this.game.player2.getName(),this.game.gameWidth/2,40),e.font="12px Arial",e.fillText(this.game.player1.getWins()+":"+this.game.player2.getWins(),this.game.gameWidth/2,60)}},{key:"drawPlayers",value:function(e){for(var t=a,n=0;n<2;n++){var i=0===n?this.game.player1:this.game.player2;0===n?(this.drawPlayer(e,{player:i,imageX:t.position.x,posX:t.position.x,barX:0,attackDir:1}),this.drawCells(e,{x:t.position.x,y:t.position.y+t.size.y},i),this.drawPoints(e,{x:t.position.x+t.size.x+25,y:t.position.y+t.size.y/2},i)):(this.drawPlayer(e,{player:i,imageX:this.game.gameWidth-t.position.x-t.size.x,posX:this.game.gameWidth-t.position.x-t.size.x,barX:this.game.gameWidth-t.position.x-t.size.x-t.position.x,attackDir:-1}),this.drawCells(e,{x:this.game.gameWidth-t.position.x-t.size.x,y:t.position.y+t.size.y},i),this.drawPoints(e,{x:this.game.gameWidth-t.position.x-t.size.x-25,y:t.position.y+t.size.y/2},i))}}},{key:"drawPlayer",value:function(e,t){var n=a,r=t.player,o=r.options.attack,s=o.startTime,c={width:o.width,height:o.height},l=i[r.index]({x:t.posX,y:n.position.y-10,width:n.size.x,attackStartTime:s,currentAttackTime:r.attack.time});e.beginPath(),e.globalAlpha=Math.max(0,1-r.attack.time/s),e.fillStyle="black",e.strokeStyle="blue",e.rect(l.x,l.y,c.width,c.height),e.fill(),e.stroke(),e.beginPath(),e.font="14px Arial",e.fillStyle="#fff",e.textAlign="center",e.fillText(r.attack.params.name,l.x+c.width/2,l.y+4+c.height/2),e.globalAlpha=1,e.drawImage(r.skin,t.imageX,n.position.y,n.size.x,n.size.y),e.beginPath(),e.strokeStyle=r.currentOptions.color,e.rect(t.posX,n.position.y,n.size.x,n.size.y),e.stroke(),this.drawBars(e,t.barX,r)}},{key:"drawCells",value:function(e,t,n){Object.keys(n.abilities).forEach((function(a,i){e.drawImage(n.abilities[a].img,t.x+55*i,t.y+15,40,40)}));for(var a=0;a<3;a++)e.beginPath(),e.strokeStyle="#fff",e.lineWidth="1",e.rect(t.x+55*a,t.y+15,40,40),e.stroke()}},{key:"drawPoints",value:function(e,t,n){for(var a=0;a<3;a++)e.beginPath(),e.fillStyle=n.position===a?"green":"#8c8c8c",e.lineWidth="1",e.arc(t.x,t.y-27+27*a,7,0,2*Math.PI),e.fill();for(var i=0;i<3;i++)e.beginPath(),e.strokeStyle="#fff",e.lineWidth="1",e.arc(t.x,t.y-27+27*i,7,0,2*Math.PI),e.stroke()}},{key:"drawBars",value:function(e,t,n){var i=a,r=i.position.y-5,o={x:t+i.position.x,y:r-93},s={x:t+i.position.x,y:r-62},c={x:t+i.position.x,y:r-31};e.textAlign="left",this.drawBar(e,o,{firstColor:"red",mainColor:"#078c07",player:i,currentPlayer:n,values:[n.hp,n.maxhp]}),this.drawBar(e,s,{firstColor:"#ddd",mainColor:"#38a0d2",player:i,currentPlayer:n,values:[n.energy,n.maxenergy]}),this.drawBar(e,c,{firstColor:"#ddd",mainColor:"#19287b",player:i,currentPlayer:n,values:[n.mana,n.maxmana]})}},{key:"drawBar",value:function(e,t,n){e.beginPath(),e.fillStyle=n.firstColor,e.rect(t.x,t.y,n.player.size.x,n.player.health.size),e.fill(),e.beginPath(),e.fillStyle=n.mainColor,e.rect(t.x,t.y,Math.max(0,n.player.size.x*(n.values[0]/n.values[1])),n.player.health.size),e.fill(),e.font="12px Arial",e.fillStyle="#fff",e.fillText(n.values[0]+"/"+n.values[1],t.x+5,t.y+16),e.beginPath(),e.strokeStyle="#fff",e.lineWidth="1",e.rect(t.x,t.y,n.player.size.x,n.player.health.size),e.stroke()}}])&&r(t.prototype,n),o&&r(t,o),e}();function s(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var c=function(){function e(t,n,a,i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=document.querySelector("#game"),this.ctx=this.canvas.getContext("2d"),this.engine=t,this.display=new o(this),this.gameWidth=this.canvas.width,this.gameHeight=this.canvas.height,this.turns=0,this.turnTimer=null,this.singleMode=r.singleMode||!1,this.difficult=Number(r.difficult)||1,this.player1=a,this.player2=i,this.players=[this.player1,this.player2],this.setMyPlayer(n),this.firstPlayer=1,this.setCurrentPlayer(),this.setBackground(r.bgIndex)}var t,n,a;return t=e,(n=[{key:"onSocketEvent",value:function(e,t){var n=this;switch(e){case"gameChangeTurn":console.log("socket change turn, ",this.turns);var a=this.opponentPlayer.controls[t.code];this.prepareAttack(a,this.opponentPlayer),this.turns<2&&(this.changeTurn(this.opponentPlayer,this.myPlayer),this.turnTimer=setTimeout((function(){n.makeTurn("KeyL")}),1500));break;case"gameEndCalculating":this.player1.setHealth(t.health1),this.player2.setHealth(t.health2);break;case"gameEndAttack":console.log("socket gameEndAttack"),this.players.forEach((function(e){e.setState("endAttack",e.attack.params)}));break;case"gameOpponentAbilities":console.log("socket gameOpponentAbilities"),console.log(t.abilities),this.opponentPlayer.parseAbilities(t.abilities);break;case"gameOpponentPosition":this.opponentPlayer.position=t.num;break;case"gameEndTurn":console.log("socket gameEndTurn"),this.round()}}},{key:"setMyPlayer",value:function(e){this.myPlayer=1===e?this.player1:this.player2,this.opponentPlayer=1===e?this.player2:this.player1}},{key:"setCurrentPlayer",value:function(){this.currentPlayer=1===this.firstPlayer?this.player1:this.player2,this.currentPlayer.currentOptions.color="aqua"}},{key:"setBackground",value:function(e){var t=new Image;t.src="/static/img/bg/".concat(e,".jpg"),this.background=t}},{key:"setPosition",value:function(e){this.isTurningPlayer()&&this.turns<2&&(this.myPlayer.position=e-1,this.emit("gameOpponentPosition",{num:e-1}))}},{key:"setAIPosition",value:function(e){console.log("set position to ",e),this.opponentPlayer.position=e}},{key:"makeTurn",value:function(e){if("KeyM"!==e){if(this.isTurningPlayer()&&this.turns<2){console.log("make turn player",this.currentPlayer.index,this.singleMode);var t=this.myPlayer.controls[e];if(!this.myPlayer.isAttackAvailable(t))return;clearTimeout(this.turnTimer),this.prepareAttack(t,this.myPlayer),this.emit("gameChangeTurn",{attackCode:e}),this.endTurn()}}else console.log(this)}},{key:"endTurn",value:function(){var e=this;this.turns>=2?this.endTurns():this.singleMode?(this.changeTurn(this.currentPlayer),this.isTurningPlayer()?this.turnTimer=setTimeout((function(){e.makeTurn("KeyL")}),1500):setTimeout((function(){e.makeAITurn()}),500+500*Math.random())):this.changeTurn(this.myPlayer,this.opponentPlayer)}},{key:"changeTurn",value:function(e,t){console.log("change turn, turns: ",this.turns),e.currentOptions.color=e.options.color,void 0!==t?(this.currentPlayer=t,t.currentOptions.color="aqua"):(this.currentPlayer=this.currentPlayer===this.player1?this.player2:this.player1,this.currentPlayer.currentOptions.color="aqua")}},{key:"endTurns",value:function(){var e=this;setTimeout((function(){console.log("подсчет"),e.calculateDamage(e.player1.attack.params,e.player2.attack.params),setTimeout((function(){e.players.forEach((function(e){e.setState("endAttack",e.attack.params)})),console.log("send end turn"),e.emit("gameEndAttack"),setTimeout((function(){e.round(),e.emit("gameEndTurn")}),600)}),600)}),1e3)}},{key:"round",value:function(){this.turns=0,this.singleMode?this.players.forEach((function(e){e.updateAbilities()})):this.myPlayer.updateAbilities(),this.checkWinner(),this.emit("gameOpponentAbilities",{abilities:this.myPlayer.getAbilities()})}},{key:"getCounterattack",value:function(){var e=this.myPlayer.attack.params.counterattack;return!!e&&e[Math.floor(Math.random()*e.length)]}},{key:"getOpponent",value:function(){return this.currentPlayer===this.player1?this.player2:this.player1}},{key:"getRandom",value:function(e){return Math.floor(Math.random()*e)}},{key:"makeAITurn",value:function(){var e=this,t=!0,n=this.currentPlayer.controls,a=Object.keys(n).filter((function(e){return"KeyL"!==e}));if(this.difficult>=2&&(a=a.filter((function(e){return"KeyW"!==e&&"KeyS"!==e})),0===this.turns&&(this.currentPlayer.energy>=20&&(a=a.filter((function(e){return"KeyZ"!==e&&"KeyX"!==e&&"KeyA"!==e}))),this.setAIPosition(this.getRandom(3)))),this.turns>0&&Math.random()<.3*this.difficult){var i=this.myPlayer.position;i!==this.opponentPlayer.position&&this.setAIPosition(i)}for(var r=function(){var n=void 0;n=a[Math.floor(Math.random()*a.length)],e.difficult>=2&&1===e.turns&&e.currentPlayer.energy>=20&&Math.random()<.35*(e.difficult-1)&&e.getCounterattack()&&(n=e.getCounterattack());var i=e.currentPlayer.controls[n];e.currentPlayer.isAttackAvailable(i)?(t=!1,e.prepareAttack(i,e.currentPlayer),e.endTurn()):(console.log("try again"),a=a.filter((function(e){return e!==n})))};t;)r()}},{key:"prepareAttack",value:function(e,t){this.turns+=1,t.setState("attack",e),t.energy-=e.energy,e.mana&&(t.mana-=e.mana),t.updateState()}},{key:"emit",value:function(e,t){this.singleMode||this.engine.emitToRoom(e,t)}},{key:"calculateDamage",value:function(e,t){for(var n=this.player1,a=this.player2,i=0;i<2;i++){if(i>0){var r=[t,e];e=r[0],t=r[1];var o=[a,n];n=o[0],a=o[1]}var s=!0;if((this.getOpponent().position===this.currentPlayer.position||(s=!1,this.currentPlayer!==n))&&e)for(var c=0;c<e.attackArea.length;c++)if(e.attackArea[c]===t.position){if(t.blockType&&t.blockType===e.attackType&&s){var l=Math.max(0,Math.floor(-e.damage[c]+e.damage[c]*t.blockPercentage/100));a.updateHealth(l)}else{var u=e.damage[c];e.weakness&&s&&e.weakness.forEach((function(e){e.id===t.id&&(u+=e.damage)}));var y=u*a.armor/100;a.updateHealth(Math.floor(-u+y))}break}}this.emit("gameEndCalculating",{health1:a.hp,health2:n.hp})}},{key:"checkWinner",value:function(){var e=this,t=!1;this.player1.hp<=0&&(this.player2.wins+=1,t=!0),this.player2.hp<=0&&(this.player1.wins+=1,t=!0),t&&this.restartGame(),this.singleMode?this.isTurningPlayer()||setTimeout((function(){e.makeAITurn()}),(t?2e3:500)+500*Math.random()):this.isTurningPlayer()&&(this.turnTimer=setTimeout((function(){e.makeTurn("KeyL")}),2500))}},{key:"restartGame",value:function(){this.players.forEach((function(e){e.reset()})),this.firstPlayer=1===this.firstPlayer?2:1,this.setCurrentPlayer()}},{key:"isTurningPlayer",value:function(){return this.myPlayer===this.currentPlayer}},{key:"update",value:function(){this.players.forEach((function(e){e.attack.dir>0&&e.attack.time>0?e.attack.time-=e.options.attack.speed:e.attack.dir<0&&e.attack.time<e.options.attack.startTime&&(e.attack.time+=e.options.attack.speed)}))}},{key:"render",value:function(){this.display.render()}}])&&s(t.prototype,n),a&&s(t,a),e}();function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var h={Digit1:1,Digit2:2,Digit3:3},f=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=null,this.play=!1,this.roomId=null,this.socket=t,document.addEventListener("keydown",(function(e){var t=h[e.code];t?n.setPlayerPosition(t):n.makeTurn(e.code)})),window.onblur=function(){n.pauseGame()},window.onfocus=function(){n.continueGame()},this.socket.on("gameChangeTurn",(function(e){n.game.onSocketEvent("gameChangeTurn",e)})),this.socket.on("gameEndCalculating",(function(e){n.game.onSocketEvent("gameEndCalculating",e)})),this.socket.on("gameEndAttack",(function(){n.game.onSocketEvent("gameEndAttack")})),this.socket.on("gameOpponentAbilities",(function(e){n.game.onSocketEvent("gameOpponentAbilities",e)})),this.socket.on("gameOpponentPosition",(function(e){n.game.onSocketEvent("gameOpponentPosition",e)})),this.socket.on("gameEndTurn",(function(){n.game.onSocketEvent("gameEndTurn")}))}var t,n,a;return t=e,(n=[{key:"startGame",value:function(e,t,n,a){this.game=new c(this,e,t,n,a),this.roomId=a.roomId,this.play||(this.run(),this.play=!0)}},{key:"makeTurn",value:function(e){this.play&&this.game.makeTurn(e)}},{key:"setPlayerPosition",value:function(e){this.play&&this.game.setPosition(e)}},{key:"pauseGame",value:function(){this.emitToRoom("gamePlayersStatus",{status:!1})}},{key:"continueGame",value:function(){this.emitToRoom("gamePlayersStatus",{status:!0})}},{key:"run",value:function(){var e=this;!function t(){e.game.update(),e.game.render(),window.requestAnimationFrame(t)}()}},{key:"emitToRoom",value:function(e,t){if(this.roomId){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({roomId:this.roomId},t);this.socket.emit(e,n)}}}])&&y(t.prototype,n),a&&y(t,a),e}();function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var k=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t.name,this.setSkin(t.skin),this.wins=0,this.maxhp=150,this.hp=this.maxhp,this.maxmana=50,this.mana=this.maxmana,this.maxenergy=80,this.manaRegen=5,this.energy=this.maxenergy,this.energyRegen=10,this.armor=0,this.position=0,this.index=t.index,this.preparedAbilities=[],this.abilities={},this.options={color:"#fff",attack:{width:200,height:50,startTime:215,speed:6}},this.currentOptions={color:this.options.color},this.attack={time:this.options.attack.startTime,dir:-1,params:{name:""}},this.passiveAbilities={"enchanted-steel":{keyName:"enchanted-steel",iconSrc:"enchanted-steel.jpg",turns:4,effects:{armor:60}}},this.controls={KeyW:{damage:[0],attackArea:[-1],position:0,energy:-10,counterattack:["KeyD","KeyA"],name:"Прыжок"},KeyS:{damage:[0],attackArea:[-1],position:2,energy:-10,counterattack:["KeyG"],name:"Присед"},KeyF:{id:0,damage:[20],attackArea:[1],attackType:1,position:1,energy:20,counterattack:["KeyJ"],name:"Удар в голову"},KeyG:{id:1,damage:[20,20],attackArea:[1,2],attackType:1,position:1,energy:20,counterattack:["KeyF"],weakness:[{id:0,damage:-20}],name:"Удар с ноги"},KeyJ:{id:2,damage:[20,5],attackArea:[1,2],attackType:3,position:2,energy:20,counterattack:["KeyG"],weakness:[{id:1,damage:-20}],name:"Подножка"},KeyH:{id:3,damage:[20,15],attackArea:[0,1],attackType:1,position:0,energy:20,counterattack:["KeyD"],weakness:[{id:5,damage:-15},{id:4,damage:-20}],name:"Удар в прыжке"},KeyA:{id:4,damage:[20],attackArea:[0],attackType:1,position:0,energy:20,counterattack:["KeyD"],name:"Захват в прыжке"},KeyD:{id:5,damage:[20],attackArea:[0],attackType:1,position:1,energy:20,counterattack:["KeyF","KeyG","KeyJ"],name:"Удар с низа"},KeyZ:{damage:[0],attackArea:[-1],position:1,blockType:1,blockPercentage:100,energy:-10,counterattack:["KeyJ"],name:"Блок"},KeyX:{damage:[0],attackArea:[-1],position:2,blockType:3,blockPercentage:100,energy:-10,counterattack:["KeyG"],name:"Нижний блок"},KeyL:{damage:[0],attackArea:[-1],position:1,energy:-10,name:"Ничего не делать"},KeyQ:{damage:[60],attackArea:[1],attackType:1,position:1,energy:20,mana:35,turns:0,type:"active",counterattack:["KeyJ","KeyH"],name:"Силовой удар"},KeyE:{damage:[0],attackArea:[-1],position:1,energy:10,mana:35,type:"passive",counterattack:["KeyJ","KeyH","KeyF"],options:this.passiveAbilities["enchanted-steel"],name:"Зачарованная сталь"}}}var t,n,a;return t=e,(n=[{key:"setSkin",value:function(e){var t=new Image;t.src=e,this.skin=t}},{key:"getName",value:function(){return this.name}},{key:"getWins",value:function(){return this.wins}},{key:"setState",value:function(e,t){switch(e){case"attack":console.log("attack state, ",this.index),this.attack={time:this.options.attack.startTime,params:t,dir:1};break;case"endAttack":console.log("end attack state, ",this.index),this.attack.time=0,this.attack.dir=-1}}},{key:"reset",value:function(){this.hp=this.maxhp,this.mana=this.maxmana,this.energy=this.maxenergy,this.currentOptions.color=this.options.color,this.abilities={}}},{key:"updateState",value:function(){this.energy=Math.min(this.energy+this.energyRegen,this.maxenergy),this.mana=Math.min(this.mana+this.manaRegen,this.maxmana)}},{key:"prepareAbility",value:function(e){"passive"===e.type&&this.preparedAbilities.push(e)}},{key:"applyAbility",value:function(e){var t=this,n=new Image;n.src="/static/img/abilities/"+e.options.iconSrc,this.abilities[e.options.keyName]={turns:e.options.turns,img:n,iconSrc:e.options.iconSrc,effects:p({},e.options.effects)},Object.keys(e.options.effects).forEach((function(n){t[n]+=e.options.effects[n]}))}},{key:"removeAbility",value:function(e){var t=this,n=this.abilities[e];Object.keys(n.effects).forEach((function(e){t[e]-=n.effects[e]})),delete this.abilities[e]}},{key:"updateAbilities",value:function(){var e=this;Object.keys(this.abilities).forEach((function(t){(e.abilities[t].turns-=1)<=0&&e.removeAbility(t)})),this.preparedAbilities.forEach((function(t){e.applyAbility(t)})),this.preparedAbilities=[]}},{key:"getAbilities",value:function(){return Object.keys(this.abilities)}},{key:"parseAbilities",value:function(e){var t=this;e.forEach((function(e){if(!t.abilities.hasOwnProperty(e)){var n=t.passiveAbilities[e],a=new Image;a.src="/static/img/abilities/"+n.iconSrc,Object.keys(n.effects).forEach((function(e){t[e]+=n.effects[e]})),t.abilities[e]={img:a}}})),Object.keys(this.abilities).forEach((function(n){if(!e.includes(n)){var a=t.passiveAbilities[n];Object.keys(a.effects).forEach((function(e){t[e]-=a.effects[e]})),delete t.abilities[n]}}))}},{key:"isAttackAvailable",value:function(e){return!(!e||this.energy<e.energy||e.mana&&!this.isAbilityAvailable(e)||(this.prepareAbility(e),0))}},{key:"isAbilityAvailable",value:function(e){return!(this.mana<e.mana||e.turns&&this.turns!==e.turns)}},{key:"updateHealth",value:function(e){this.hp+=e}},{key:"setHealth",value:function(e){this.hp=e}}])&&d(t.prototype,n),a&&d(t,a),e}();function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(a,e);var t,n=(t=a,function(){var e,n=x(t);if(P()){var a=x(this).constructor;e=Reflect.construct(n,arguments,a)}else e=n.apply(this,arguments);return v(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=n.call(this,e)).maxhp=200,t.hp=200,t.controls={KeyF:{damage:[30],attackArea:[1],attackType:1,position:1,energy:20,name:"Прямой удар"},KeyZ:{damage:[0],attackArea:[-1],position:1,blockType:1,blockPercentage:100,energy:-10,name:"Блок"},KeyL:{damage:[0],attackArea:[-1],position:1,energy:-10,name:"Ничего не делать"}},t}return a}(k);function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,i=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){i=!0,r=e}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}window.onload=function(){!function(){var e,t=io(window.location.host);fetch("/getName",{method:"POST"}).then((function(e){return e.json()})).then((function(t){e=t.name})),t.emit("init"),t.on("init",(function(e){r(e.rooms)}));var n={gameContainer:document.querySelector(".game"),roomsContainer:document.querySelector(".room-list"),formCreateRoom:document.getElementById("js-create-room"),formTraining:document.getElementById("js-training-form"),formBoss:document.getElementById("js-boss-form"),gameStatus:document.querySelector(".js-game-status"),player1Info:document.querySelector(".js-player-info-1"),player2Info:document.querySelector(".js-player-info-2")};n.formCreateRoom.onsubmit=function(a){a.preventDefault();var i=new FormData(a.target),r=i.get("room_id"),o=i.get("room_bg");r&&(t.emit("createRoom",{roomId:r,bgIndex:o,name:e}),n.gameContainer.classList.add("active"))};var a={1:"Легкий",2:"Средний",3:"Тяжелый"};n.formTraining.onsubmit=function(t){t.preventDefault();var n=new FormData(t.target).get("difficult"),i="ИИ ("+a[n]+")";o({status:"Игра",playerIndex:1,player1:{name:e},player2:{name:i}});var r=new k({name:e,skin:"/static/img/skins/1.jpg",index:1}),c=new k({name:i,skin:"/static/img/skins/2.jpg",index:2});s.startGame(1,r,c,{bgIndex:1+Math.floor(9*Math.random()),singleMode:!0,difficult:n})};var i={"forest-golem":T};n.formBoss.onsubmit=function(t){t.preventDefault();var n=new FormData(t.target).get("boss_name"),a="Босс "+n.match(new RegExp(/\(.+?\)/))[0],r=n.match(new RegExp(/.+(?=\()/));o({status:"Игра",playerIndex:1,player1:{name:e},player2:{name:a}});var c=new k({name:e,skin:"/static/img/skins/1.jpg",index:1}),l=new i[r]({name:a,skin:"/static/img/skins/boss/golem.png",index:2});s.startGame(1,c,l,{bgIndex:11,singleMode:!0,difficult:3})};var r=function(a){n.roomsContainer.innerHTML="",Object.entries(a).forEach((function(a){var i=A(a,2),r=i[0],o=(i[1],document.createElement("li"));o.className="room-list__item";var s=document.createElement("button");s.textContent="Комната "+r,s.addEventListener("click",(function(){t.emit("joinRoom",{name:e,roomId:r})})),o.appendChild(s),n.roomsContainer.appendChild(o)}))};function o(e){n.gameStatus.innerHTML=e.status,n.gameContainer.classList.add("active"),n.gameContainer.classList.add("play"),n.player1Info.querySelector(".player-info__name").innerHTML=e.player1.name,n.player2Info.querySelector(".player-info__name").innerHTML=e.player2.name,2===e.playerIndex?n.player1Info.classList.add("js-opponent-info"):n.player2Info.classList.add("js-opponent-info"),document.querySelector(".js-opponent-info").classList.remove("left")}t.on("roomListUpdated",(function(e){r(e.rooms)})),t.on("startGame",(function(e){o(e);var t=new k({name:e.player1.name,skin:"/static/img/skins/1.jpg",index:1}),n=new k({name:e.player2.name,skin:"/static/img/skins/2.jpg",index:2});s.startGame(e.playerIndex,t,n,{bgIndex:e.bgIndex,roomId:e.roomId})})),t.on("gamePlayersStatus",(function(e){e.status?document.querySelector(".js-opponent-info").classList.remove("off"):document.querySelector(".js-opponent-info").classList.add("off")})),t.on("gameUserLeft",(function(e){document.querySelector(".js-opponent-info").classList.add("left")}));var s=new f(t)}()}}]);